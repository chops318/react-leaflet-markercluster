"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),_react=require("react"),_reactLeaflet=require("react-leaflet"),_leaflet=require("leaflet"),_leaflet2=_interopRequireDefault(_leaflet);require("leaflet.markercluster"),require("./style.scss");var prevMarkerClusterGroup=void 0,MarkerClusterGroup=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"componentDidMount",value:function(){this.props.markers&&this.props.markers.length&&this.addMarkerClusterGroupToMap(this.props.markers),this.props.wrapperOptions.enableDefaultStyle&&(this.context.map._container.className+=" marker-cluster-styled"),!this.props.wrapperOptions.disableDefaultAnimation&&(this.context.map._container.className+=" marker-cluster-animated")}},{key:"componentWillReceiveProps",value:function(e){e.markers&&e.markers.length&&(prevMarkerClusterGroup&&this.layerContainer.removeLayer(prevMarkerClusterGroup),this.addMarkerClusterGroupToMap(e.markers))}},{key:"removeMarkersWithSameCoordinates",value:function(e){var r=[e[0]];return e.forEach(function(e){JSON.stringify(r).includes(JSON.stringify(e))||r.push(e)}),r}},{key:"addMarkerClusterGroupToMap",value:function(e){var r=this.props.markerOptions?Object.assign({},this.props.markerOptions):{},t=_leaflet2.default.markerClusterGroup(this.props.options),o=this.props.wrapperOptions.removeDuplicates?this.removeMarkersWithSameCoordinates(e):e,s=[];o.forEach(function(e){var t=e.options?Object.assign({},e.options):null,o=_leaflet2.default.marker([e.lat,e.lng],t||r);e.popup&&o.bindPopup(e.popup),e.tooltip&&o.bindTooltip(e.tooltip),s.push(o)}),t.addLayers(s),this.layerContainer.addLayer(t),prevMarkerClusterGroup=t,this.initEventListeners(t)}},{key:"initEventListeners",value:function(e){var r=this;this.props.onMarkerClick&&e.on("click",function(e){r.props.onMarkerClick(e.layer)}),this.props.onClusterClick&&e.on("clusterclick",function(e){r.props.onClusterClick(e.layer)}),this.props.onPopupClose&&e.on("popupclose",function(e){r.props.onPopupClose(e.popup)})}}]),r}(_reactLeaflet.LayerGroup);exports.default=MarkerClusterGroup,MarkerClusterGroup.propTypes={markers:_react.PropTypes.arrayOf(_react.PropTypes.object),options:_react.PropTypes.object,markerOptions:_react.PropTypes.object,wrapperOptions:_react.PropTypes.object,onMarkerClick:_react.PropTypes.func,onClusterClick:_react.PropTypes.func,onPopupClose:_react.PropTypes.func},MarkerClusterGroup.defaultProps={wrapperOptions:{}};